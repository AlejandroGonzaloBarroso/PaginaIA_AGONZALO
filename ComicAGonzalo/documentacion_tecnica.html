<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentación Técnica: S-ØMBRA</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Rajdhani', sans-serif;
            background-color: #050505;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            overflow-y: auto; 
        }
        .doc-container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(10, 10, 14, 0.95);
            border: 1px solid #333;
            padding: 30px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.1);
        }
        h1, h2, h3 {
            font-family: 'Orbitron', sans-serif;
            color: #0ff;
            text-transform: uppercase;
        }
        h1 { border-bottom: 2px solid #0ff; padding-bottom: 10px; margin-bottom: 30px; }
        h2 { margin-top: 40px; color: #fff; border-left: 4px solid #f0f; padding-left: 10px; }
        .section-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 4px;
            border: 1px solid #222;
        }
        code {
            background: #111;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
            color: #ff9d00;
        }
        pre {
            background: #000;
            padding: 15px;
            overflow-x: auto;
            border: 1px solid #333;
            color: #0f0;
        }
        .tag {
            display: inline-block;
            padding: 4px 8px;
            font-size: 0.8em;
            font-weight: bold;
            border-radius: 3px;
            margin-right: 10px;
            text-transform: uppercase;
        }
        .tag-backend { background: #60a5fa; color: #000; }
        .tag-frontend { background: #f472b6; color: #000; }
        .tag-data { background: #34d399; color: #000; }
        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: #0ff;
            text-decoration: none;
            border: 1px solid #0ff;
            padding: 10px 20px;
            transition: all 0.3s;
        }
        .back-link:hover { background: #0ff; color: #000; }
    </style>
</head>
<body>

    <div class="doc-container">
        <h1>Documentación Técnica: S-ØMBRA v2.1</h1>
        <p>Este documento detalla la arquitectura técnica, flujos de datos y componentes principales de la aplicación S-ØMBRA Reader.</p>

        <!-- 1. BACKEND & SUPABASE -->
        <div class="section-card">
            <h2><span class="tag tag-backend">Backend</span>Integración con Supabase</h2>
            <p>La aplicación utiliza <strong>Supabase</strong> como Backend-as-a-Service (BaaS) para la persistencia de usuarios y progreso.</p>
            
            <h3>Inicialización</h3>
            <p>Se realiza en la función <code>initApp()</code> en <code>script.js</code>.</p>
            <pre><code>// Cliente de conexión sin persistencia automática de sesión
dbClient = window.supabase.createClient(SU, SK, {
    auth: {
        persistSession: false, 
        autoRefreshToken: false
    }
});</code></pre>
            
            <h3>Credenciales</h3>
            <p>Las claves de API están definidas como constantes globales (no recomendado para prod, aceptable para prototipos):</p>
            <ul>
                <li><code>SU</code>: URL del proyecto Supabase.</li>
                <li><code>SK</code>: Clave pública (anon key).</li>
            </ul>
        </div>

        <!-- 2. DATA STORAGE -->
        <div class="section-card">
            <h2><span class="tag tag-data">Datos</span>Almacenamiento y Estado</h2>
            <p>El estado de la aplicación se maneja de forma híbrida para permitir funcionalidad tanto Online como Offline.</p>

            <h3>Estructura de Datos (Tabla 'users')</h3>
            <p>Esquema esperado en la base de datos:</p>
            <ul>
                <li><strong>id</strong>: Identificador único.</li>
                <li><strong>name</strong>: Nombre visible del usuario.</li>
                <li><strong>lastPage</strong> (int): Última página leída.</li>
                <li><strong>currentPath</strong> (string): Ruta narrativa actual ('neutral', 'ending1', 'ending2').</li>
            </ul>

            <h3>Modo Offline</h3>
            <p>Implementado mediante la variable <code>isOffline</code>. Si la conexión falla o tarda más de 5 segundos:</p>
            <ol>
                <li>Se activa el flag <code>isOffline = true</code>.</li>
                <li>Los usuarios creados reciben IDs con prefijo <code>local-</code>.</li>
                <li>El progreso se guarda solo en memoria RAM (se pierde al recargar).</li>
            </ol>
        </div>

        <!-- 3. FILE HANDLING -->
        <div class="section-card">
            <h2><span class="tag tag-frontend">Frontend</span>Manejo de Archivos y Assets</h2>
            <p>La aplicación no utiliza un servidor de archivos complejo; sirve imágenes estáticas directamente.</p>

            <h3>Array de Páginas</h3>
            <p>Las páginas del cómic están mapeadas manualmente en el array <code>PAGES</code>:</p>
            <pre><code>const PAGES = [
    "1.png", "2.png", "3.png", ... "11 toma de decision.png"
];</code></pre>

            <h3>Renderizado de Páginas</h3>
            <p>La función <code>setPageImage(element, src)</code> manipula el CSS <code>background-image</code> para mostrar el contenido.</p>
            <p>Se utiliza un técnica de doble búfer visual (<code>#page-back</code> y <code>#page-front</code>) para transiciones suaves o efectos de "glitch".</p>
        </div>

        <!-- 4. CORE LOGIC -->
        <div class="section-card">
            <h2><span class="tag tag-frontend">Core</span>Lógica Principal</h2>
            
            <h3>Flujo de Lectura</h3>
            <ul>
                <li><strong>Start</strong>: <code>startReading()</code> oculta el overlay y carga <code>currentUser.lastPage</code>.</li>
                <li><strong>Navegación</strong>: <code>loadPage(index)</code> gestiona el índice actual. Verifica límites y detecta si se ha llegado al final.</li>
                <li><strong>Finales</strong>: Si el índice supera el total de páginas, verifica <code>currentPath</code> para mostrar la imagen final correspondiente (<code>final 1.png</code> o <code>final 2.png</code>).</li>
            </ul>

            <h3>Sistema de Decisiones</h3>
            <p>Implementado en <code>triggerDecisionPhase()</code>.</p>
            <ul>
                <li>Detecta si el nombre del archivo de imagen incluye la palabra "decision".</li>
                <li>Bloquea la navegación estándar y muestra el overlay <code>#decision-overlay</code>.</li>
                <li>La elección del usuario actualiza <code>currentPath</code> y fuerza el salto al final correspondiente.</li>
            </ul>
        </div>

        <a href="index.html" class="back-link">← Volver a la Aplicación</a>
    </div>

</body>
</html>
